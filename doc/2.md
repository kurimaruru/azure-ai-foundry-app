# プロジェクトのセットアップと基本的なコンポーネントの作成

## 1. プロジェクトのセットアップ

### 1.1 プロジェクトの作成

以下の手順で新しいReactプロジェクトを作成します：

1. createを押下
![react](image0.png)

2. Reactを選択します。
![react](image1.png)

3. Nameを入力し、Create Sandboxを押下する。
![react](image2.png)

### 1.2 Tailwind CSSのセットアップ

Tailwind CSSを利用できるように設定します：

/public/index.htmlに以下を追記します。
```html
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css"
rel="stylesheet"
/>
```
![react](image3.png)

### 1.3 利用するライブラリのセットアップ
- axios
  - ![react](image4.png)

- dotenv
  - ![react](image5.png)

## 2. 基本的なコンポーネントの作成

### 2.1 ディレクトリ構造の作成

以下のディレクトリ構造を作成します：

```
src/
  ├── components/
  │   ├── TaskForm.jsx
  │   ├── TaskList.jsx
  │   ├── TaskItem.jsx
  │   ├── TaskFilters.jsx
  │   └── TaskHelper.jsx
  ├── hooks/
  │   └── useTaskManager.js
  │   └── useAiTask.jsx
  ├── App.jsx
  └── index.js
```

### 2.2 各コンポーネントの基本実装

#### TaskForm.jsx
まずは`src/App.jsx`を編集します。

```jsx
import React from "react";
import { useTaskManager } from "./hooks/useTaskManager";
import TaskForm from "./components/TaskForm";

const App = () => {
  const { addTask } = useTaskManager();
  return (
    <div className="flex flex-col items-center p-4 max-w-2xl mx-auto bg-white rounded-lg shadow">
      <h1 className="text-2xl font-bold mb-4">タスク管理アプリ</h1>
      <TaskForm onAddTask={addTask} />
    </div>
  );
};

export default App;

```

`src/hooks/useTaskManager.js`の編集をします。
```javascript
import { useState, useEffect } from "react";

export const useTaskManager = () => {
  const [tasks, setTasks] = useState(() => {
    const savedTasks = localStorage.getItem("tasks");
    return savedTasks ? JSON.parse(savedTasks) : [];
  });

  useEffect(() => {
    localStorage.setItem("tasks", JSON.stringify(tasks));
  }, [tasks]);

  const addTask = (title, description = "", dueDate = "") => {
    if (!title.trim()) return;

    const newTask = {
      id: Date.now(),
      title,
      description,
      dueDate,
      completed: false,
    };

    setTasks([...tasks, newTask]);
  };

  return { addTask };
};

```


`src/App.jsx`で呼び出す`src/components/TaskForm`コンポーネントを作成します。

```jsx
import React, { useState } from "react";

const TaskForm = ({ onAddTask }) => {
  const [newTaskTitle, setNewTaskTitle] = useState("");
  const [description, setDescription] = useState("");
  const [dueDate, setDueDate] = useState("");

  const handleSubmit = (e) => {
    e.preventDefault();
    if (!newTaskTitle.trim() || !description.trim() || !dueDate) {
      return;
    }
    onAddTask(newTaskTitle, description, dueDate);
    setNewTaskTitle("");
    setDescription("");
    setDueDate("");
  };

  return (
    <form onSubmit={handleSubmit} className="w-full mb-6">
      <div className="flex mb-2">
        <input
          type="text"
          value={newTaskTitle}
          onChange={(e) => setNewTaskTitle(e.target.value)}
          placeholder="タスクのタイトルを入力..."
          className="flex-grow p-2 border border-gray-300 rounded-l focus:outline-none"
          required
        />
        <div className="p-2 border border-gray-300 rounded-l focus:outline-none">
          期限
        </div>
        <input
          type="date"
          value={dueDate}
          onChange={(e) => setDueDate(e.target.value)}
          className="p-2 border border-gray-300 focus:outline-none"
          required
        />
        <button
          type="submit"
          className="bg-blue-500 text-white px-4 py-2 rounded-r hover:bg-blue-600"
        >
          追加
        </button>
      </div>
      <textarea
        value={description}
        onChange={(e) => setDescription(e.target.value)}
        placeholder="タスクの詳細を入力..."
        className="w-full p-2 border border-gray-300 rounded focus:outline-none"
        rows="2"
        required
      />
    </form>
  );
};

export default TaskForm;
```

ここまで実装できたら、実装した画面を確認してみましょう。
タスク登録フォームが表示されていればOKです！試しにタスクを追加してみてください。
![react](image6.png)

#### TaskList.jsx
TaskListコンポーネントを追加し、`src/App.jsx`を更新します。

```jsx
import React from "react";
import { useTaskManager } from "./hooks/useTaskManager";
import TaskForm from "./components/TaskForm";
import TaskList from "./components/TaskList"; // 追加

const App = () => {
  // tasks, updateTask, deleteTask, toggleCompleteの追加
  const { addTask, tasks, updateTask, deleteTask, toggleComplete } = useTaskManager();
  return (
    <div className="flex flex-col items-center p-4 max-w-2xl mx-auto bg-white rounded-lg shadow">
      <h1 className="text-2xl font-bold mb-4">タスク管理アプリ</h1>
      <TaskForm onAddTask={addTask} />
      {/* TaskListの追加 */}
      <TaskList
        tasks={tasks}
        onToggleComplete={toggleComplete}
        onDelete={deleteTask}
        onUpdate={updateTask}
      />
    </div>
  );
};

export default App;

```


`src/hooks/useTaskManager.js`の編集をします。
```javascript
import { useState, useEffect } from "react";

export const useTaskManager = () => {
  const [tasks, setTasks] = useState(() => {
    const savedTasks = localStorage.getItem("tasks");
    return savedTasks ? JSON.parse(savedTasks) : [];
  });

  useEffect(() => {
    localStorage.setItem("tasks", JSON.stringify(tasks));
  }, [tasks]);

  const addTask = (title, description = "", dueDate = "") => {
    if (!title.trim()) return;

    const newTask = {
      id: Date.now(),
      title,
      description,
      dueDate,
      completed: false,
    };

    setTasks([...tasks, newTask]);
  };

  // ------------追加ここから-----------------
  const updateTask = (id, updates) => {
    setTasks(
      tasks.map((task) => (task.id === id ? { ...task, ...updates } : task))
    );
  };

  const deleteTask = (id) => {
    setTasks(tasks.filter((task) => task.id !== id));
  };

  const toggleComplete = (id) => {
    setTasks(
      tasks.map((task) =>
        task.id === id ? { ...task, completed: !task.completed } : task
      )
    );
  };
  // ------------追加ここまで-----------------

  return { 
    addTask,
    // tasks,deleteTask,toggleComplete,updateTaskの追加
    tasks,
    deleteTask,
    toggleComplete,
    updateTask, 
  };
};

```

`src/components/TaskList.jsx`を編集します。
```jsx
import React from "react";
import TaskItem from "./TaskItem";

const TaskList = ({ tasks, onToggleComplete, onDelete, onUpdate }) => {
  return (
    <ul className="w-full">
      {tasks.length === 0 ? (
        <li className="p-4 text-center text-gray-500">タスクがありません</li>
      ) : (
        tasks.map((task) => (
          <TaskItem
            key={task.id}
            task={task}
            onToggleComplete={onToggleComplete}
            onDelete={onDelete}
            onUpdate={onUpdate}
          />
        ))
      )}
    </ul>
  );
};

export default TaskList;
```

ここまでできたら画面を操作してみましょう。
- 先ほど追加したタスクが表示されるか
  - ![react](image7.png)
- もう1件タスク追加
  - ![react](image8.png)
- タスクの更新
  - 編集ボタンを押下し、タスクタイトル、タスク詳細を更新する
  - ![react](image9.png)
  - 編集後、保存ボタンを押下し内容が更新されていることを確認する
- タスクの完了
  - チェックボックスをクリックして完了に更新する。
  - ![react](image10.png)
- タスクの削除
  - 先ほど更新したタスクの削除ボタンを押下し、タスクを削除する
  - ![react](image11.png)
  - タスクが1件になっていることを確認する。

#### TaskFilters.jsx

`src/App.jsx`を更新します。

```jsx
import React from "react";
import { useTaskManager } from "./hooks/useTaskManager";
import TaskForm from "./components/TaskForm";
import TaskList from "./components/TaskList";
import TaskFilters from "./components/TaskFilters"; // 追加

const App = () => {
  const {
    tasks,
    addTask,
    deleteTask,
    toggleComplete,
    updateTask,
      // filteredTasks,filter,setFilter,markAll,clearCompletedの追加
    filteredTasks,
    filter,
    setFilter,
    markAll,
    clearCompleted,
  } = useTaskManager();

  return (
    <div className="flex flex-col items-center p-4 max-w-2xl mx-auto bg-white rounded-lg shadow">
      <h1 className="text-2xl font-bold mb-4">タスク管理アプリ</h1>
      <TaskForm onAddTask={addTask} />
      {/* ---------TaskFiltersの追加ここから----------- */}
      <TaskFilters
        filter={filter}
        setFilter={setFilter}
        markAll={markAll}
        clearCompleted={clearCompleted}
      />
      <div className="w-full mt-4 text-sm text-gray-500">
        全タスク: {tasks.length} | 完了済み:{" "}
        {tasks.filter((t) => t.completed).length} | 未完了:{" "}
        {tasks.filter((t) => !t.completed).length}
      </div>
      {/* ---------TaskFiltersの追加ここまで----------- */}
      <TaskList
        tasks={filteredTasks} // ここをフィルター結果を表示できるように更新！！！
        onToggleComplete={toggleComplete}
        onDelete={deleteTask}
        onUpdate={updateTask}
      />

    </div>
  );
};

export default App;

```


`src/hooks/useTaskManager.js`の編集をします。
```javascript
import { useState, useEffect } from "react";

export const useTaskManager = () => {
  const [tasks, setTasks] = useState(() => {
    const savedTasks = localStorage.getItem("tasks");
    return savedTasks ? JSON.parse(savedTasks) : [];
  });

  const [filter, setFilter] = useState("all"); // filterの追加


  useEffect(() => {
    localStorage.setItem("tasks", JSON.stringify(tasks));
  }, [tasks]);

  const addTask = (title, description = "", dueDate = "") => {
    if (!title.trim()) return;

    const newTask = {
      id: Date.now(),
      title,
      description,
      dueDate,
      completed: false,
    };

    setTasks([...tasks, newTask]);
  };

  const updateTask = (id, updates) => {
    setTasks(
      tasks.map((task) => (task.id === id ? { ...task, ...updates } : task))
    );
  };

  const deleteTask = (id) => {
    setTasks(tasks.filter((task) => task.id !== id));
  };

  const toggleComplete = (id) => {
    setTasks(
      tasks.map((task) =>
        task.id === id ? { ...task, completed: !task.completed } : task
      )
    );
  };

  // ---------------ここから追加--------------------
  const markAll = (completed) => {
    setTasks(tasks.map((task) => ({ ...task, completed })));
  };

  const clearCompleted = () => {
    setTasks(tasks.filter((task) => !task.completed));
  };

  const filteredTasks = tasks.filter((task) => {
    if (filter === "active") return !task.completed;
    if (filter === "completed") return task.completed;
    return true;
  });
  // ---------------ここまで追加--------------------

  return { 
    addTask,
    tasks,
    deleteTask,
    toggleComplete,
    updateTask, 
    // filteredTasks,filter,setFilter,markAll,clearCompletedの追加
    filteredTasks,
    filter,
    setFilter,
    markAll,
    clearCompleted,
  };
};

```

`src/components/TaskFilters.jsx`コンポーネントを編集する。
```jsx
import React from "react";

const TaskFilters = ({ filter, setFilter, markAll, clearCompleted }) => {
  return (
    <div className="w-full mb-4 flex justify-between items-center">
      <div className="flex space-x-2">
        <button
          onClick={() => setFilter("all")}
          className={`px-3 py-1 rounded ${
            filter === "all" ? "bg-blue-500 text-white" : "bg-gray-200"
          }`}
          type="button"
        >
          全て
        </button>
        <button
          onClick={() => setFilter("active")}
          className={`px-3 py-1 rounded ${
            filter === "active" ? "bg-blue-500 text-white" : "bg-gray-200"
          }`}
          type="button"
        >
          未完了
        </button>
        <button
          onClick={() => setFilter("completed")}
          className={`px-3 py-1 rounded ${
            filter === "completed" ? "bg-blue-500 text-white" : "bg-gray-200"
          }`}
          type="button"
        >
          完了済み
        </button>
      </div>

      <div className="flex space-x-2">
        <button
          onClick={() => markAll(true)}
          className="px-3 py-1 bg-gray-200 rounded hover:bg-gray-300"
          type="button"
        >
          全て完了
        </button>
        <button
          onClick={() => markAll(false)}
          className="px-3 py-1 bg-gray-200 rounded hover:bg-gray-300"
          type="button"
        >
          全て未完了
        </button>
        <button
          onClick={clearCompleted}
          className="px-3 py-1 bg-red-100 rounded hover:bg-red-200 text-red-600"
          type="button"
        >
          完了を削除
        </button>
      </div>
    </div>
  );
};

export default TaskFilters;

```

ここまでできたら画面を操作してみましょう。
- まずタスクを何件か追加する
- そのうち何件かのタスクを完了にする
- フィルターの確認で、全て、未完了、完了済みのそれぞれで絞込みをする
- 全て完了、全て未完了ボタンを押下して、一括更新できるか確認する
- 完了のタスクを一括削除する


#### TaskHelper.jsx

`src/App.jsx`を更新します。

```jsx
import React from "react";
import { useTaskManager } from "./hooks/useTaskManager";
import TaskForm from "./components/TaskForm";
import TaskList from "./components/TaskList";
import TaskFilters from "./components/TaskFilters";
import AITaskHelper from "./components/TaskHelper"; // 追加

const App = () => {
  const {
    tasks,
    addTask,
    deleteTask,
    toggleComplete,
    updateTask,
    filteredTasks,
    filter,
    setFilter,
    markAll,
    clearCompleted,
  } = useTaskManager();

  return (
    <div className="flex flex-col items-center p-4 max-w-2xl mx-auto bg-white rounded-lg shadow">
      <h1 className="text-2xl font-bold mb-4">タスク管理アプリ</h1>
      <TaskForm onAddTask={addTask} />
      <TaskFilters
        filter={filter}
        setFilter={setFilter}
        markAll={markAll}
        clearCompleted={clearCompleted}
      />
      <div className="w-full mt-4 text-sm text-gray-500">
        全タスク: {tasks.length} | 完了済み:{" "}
        {tasks.filter((t) => t.completed).length} | 未完了:{" "}
        {tasks.filter((t) => !t.completed).length}
      </div>
      <TaskList
        tasks={filteredTasks}
        onToggleComplete={toggleComplete}
        onDelete={deleteTask}
        onUpdate={updateTask}
      />
      {/* ---------TaskFiltersの追加ここから----------- */}
      <AITaskHelper filteredTasks={filteredTasks} />
      {/* ---------TaskFiltersの追加ここまで----------- */}
    </div>
  );
};

export default App;

```

`src/hooks/useAiTask.ts`を追加
```javascript
import axios from "axios";

export const useAiTask = (setResult, setIsLoading) => {
  // Azure OpenAI APIを呼び出す関数
  const DescriptionTaskByAi = async (prompt, tasks) => {
    setIsLoading(true);

    try {
      const response = await axios.post(
        process.env.REACT_APP_AZURE_OPENAI_ENDPOINT,
        {
          messages: [
            { role: "system", content: "あなたはタスク管理の専門家です。" },
            {
              role: "user",
              content: `
                あなたはタスク管理マネージャーです。
                「# ユーザーの指示」に回答する際に「# タスク一覧」をもとに回答を生成してください。
                タスク一覧が持つ情報については以下の通りになります。
                # タスク情報
                - id: タスクのIDで、タスクごとに一意になる
                - title: タスクのタイトル
                - description: タスクの詳細説明
                - dueDate: タスクの期限日
                - completed: タスクの完了状況
                
                # タスク一覧
                - ${JSON.stringify(tasks)}

                # ユーザーの指示
                ${prompt}
            `,
            },
          ],
          max_tokens: 150,
          temperature: 0.7,
        },
        {
          headers: {
            "Content-Type": "application/json",
            "api-key": process.env.REACT_APP_AZURE_OPENAI_KEY,
          },
        }
      );

      setResult(response.data.choices[0].message.content);
    } catch (error) {
      console.error("Azure OpenAI API error:", error);
      setResult("エラーが発生しました。もう一度お試しください。");
    } finally {
      setIsLoading(false);
    }
  };

  return { DescriptionTaskByAi };
};

```

`src/components/AITaskHelper.jsx`の追加

```jsx
import React, { useState } from "react";
import { useAiTask } from "../hooks/useAiTask";

const AITaskHelper = ({ filteredTasks }) => {
  const [input, setInput] = useState("");
  const [result, setResult] = useState("");
  const [isLoading, setIsLoading] = useState(false);

  const { DescriptionTaskByAi } = useAiTask(setResult, setIsLoading);

  const handleSubmit = (e) => {
    e.preventDefault();
    if (!input.trim()) return;

    DescriptionTaskByAi(input, filteredTasks);
  };

  return (
    <div className="w-full p-4 border rounded shadow">
      <h2 className="text-xl font-bold mb-4">AIタスクヘルパー</h2>

      <form onSubmit={handleSubmit} className="mb-4">
        <div className="flex">
          <input
            type="text"
            value={input}
            onChange={(e) => setInput(e.target.value)}
            placeholder="タスクについて質問してください..."
            className="flex-grow p-2 border rounded-l"
          />
          <button
            type="submit"
            className="bg-blue-500 text-white px-4 py-2 rounded-r"
            disabled={isLoading}
          >
            {isLoading ? "処理中..." : "送信"}
          </button>
        </div>
      </form>
      <div className="mt-4 p-3 bg-gray-50 rounded">
        <h3 className="font-semibold mb-2">AIの提案:</h3>
        <p>{result}</p>
      </div>
    </div>
  );
};

export default AITaskHelper;

```

Azure AI FoundryのAPIを呼び出すには環境変数で、エンドポイントやAPIキーを登録する必要があります。こちらについては後程設定しますので、動作確認は一旦スキップします。

## 2.3 プロジェクトをGithubで管理

コードの修正は以上となります。お疲れ様でした。

次は編集したコードをGithubで管理できるようにしたいのですが以下のような目的があります。
- 作成したコードをいつでも振り返れるように
- Githubでコード管理すると、CodeSandboxの「devbox」というプロジェクトを仮想マシンで動かすための環境を利用することができるようになります。
  - Azure AI Foundryを利用するうえでdevboxだと環境変数を安全に取り扱えることができるようになるためdevboxを今回は利用します。


では左側のメニューからGithubのアイコンをクリックしてください。

次にCreate repositoryを選択します。

![react](image14.png)

リポジトリ名は自由に設定してください。

画像の赤枠で囲んだ部分のプライバシー設定は「Private」にしてください。

![react](image15.png)

次はdevboxを利用するための設定を行います。

Create repositoryをした後は以下のような画面が自動で表示されます。
そのままNextを選択します。

![react](image16.png)

Step2も何も変更せずにNextをクリック

Step3もいったん何も設定せずにNextを押下していただきますが、後ほど環境変数は設定します。

Step4 , Step5も何も変更せずにNextをクリック

Step6まできたら、Applyをクリックする。

![react](image17.png)

では、プレビュー画面を表示してみましょう。
赤枠で囲んだメニューを選択し、Previewsのポート番号3000を選択する。

![react](image18.png)

プレビュー画面に実装した画面が表示されればOKです。

![react](image19.png)

## 2.4 環境変数の設定とAzure AI Foundryで作成したAPIの動作確認

Azure AI Foundryプロジェクトを作成（第3回のスライドで確認）

プロジェクトが完成したらチャットプレイグラウンドを開きます。

コードの表示メニューをクリックします。
開いたら、キー認証を選択してください。

![react](image20.png)

下にスクロールするとエンドポイントとAPIキーが表示されています。

![react](image21.png)

こちらをCodesandboxの方に環境変数として登録していきます。
`src/hooks/useAiTask.js`のコードの中で出現する環境変数は以下の2つです。
- REACT_APP_AZURE_OPENAI_ENDPOINT
- REACT_APP_AZURE_OPENAI_KEY


![react](image22.png)

すると以下が表示されるので、先ほどAzure AI Foundryのチャットプレイグラウンドで見た環境変数を設定します。

![react](image23.png)

設定ができたら、「Restart microVM」をクリックし、仮想環境を再起動します。

再起動が完了したらAzure AI FoundryのAPIが叩けるようになるので、動作確認してみましょう。

AIタスクヘルパーに以下のように入力してテストしてみましょう。

![react](image24.png)

上記のようにAzure AI Foundryで作成したモデルをReact側から呼び出すことができました。